<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoffeeCup AI Assistant</title>
    <link rel="stylesheet" href="unified-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="dark-theme">
    <div id="app-container">
        <aside id="settings-panel">
            <div class="settings-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <div>
                    <button id="theme-toggle" class="icon-btn" title="Toggle Theme">
                        <i class="fas fa-sun"></i>
                    </button>
                    <button id="sidebar-toggle" class="icon-btn" title="Toggle Sidebar">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
            </div>
            <div class="settings-content">
                <div class="setting-item">
                    <label for="backend-select"><i class="fas fa-server"></i> Backend</label>
                    <select id="backend-select">
                        <option value="ollama">Ollama (Local)</option>
                        <option value="openrouter">OpenRouter (Cloud)</option>
                        <option value="websim">Websim AI (Cloud)</option>
                    </select>
                </div>
                <div class="setting-item" id="model-input-container">
                    <label for="model-select"><i class="fas fa-brain"></i> Model Name</label>
                    <div class="input-with-icon">
                        <select id="model-select"></select>
                        <button id="refresh-models" class="icon-btn refresh-btn" title="Refresh Models"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <small>If empty, server default will be used.</small>
                </div>
                <div class="setting-item" id="websim-key-container">
                    <label for="websim-key-input"><i class="fas fa-key"></i> Websim API Key</label>
                    <input type="password" id="websim-key-input" placeholder="Enter your Websim key">
                    <small>Required for the Websim backend.</small>
                </div>
                <div class="setting-item">
                    <label for="filepath-select"><i class="fas fa-file-alt"></i> Target File Path</label>
                     <div class="input-with-icon">
                        <select id="filepath-select"></select>
                        <button id="refresh-files" class="icon-btn refresh-btn" title="Refresh Files"><i class="fas fa-sync-alt"></i></button>
                    </div>
                     <small>Required to apply changes to a file.</small>
                </div>
                <div class="setting-item">
                    <label for="server-url-input"><i class="fas fa-link"></i> Server URL</label>
                    <input type="text" id="server-url-input" placeholder="e.g., http://localhost:3690">
                    <small>The URL of your local backend server.</small>
                </div>
                 <div class="setting-item">
                    <label><i class="fas fa-network-wired"></i> Connection Status</label>
                    <div id="status-indicators">
                        <div class="status-item"><span>Server</span><span class="status-dot" id="status-server"></span></div>
                        <div class="status-item"><span>Ollama</span><span class="status-dot" id="status-ollama"></span></div>
                        <div class="status-item"><span>OpenRouter API</span><span class="status-dot" id="status-openrouter"></span></div>
                        <div class="status-item"><span>Websim</span><span class="status-dot" id="status-websim"></span></div>
                    </div>
                </div>
            </div>
            <footer>
                <p>Powered by The Voice and Eye of Bhambatha Inc.</p>
            </footer>
        </aside>
        <div id="resize-handle"></div>
        <div id="main-content">
            <header>
                <button id="sidebar-toggle-main" class="icon-btn" title="Toggle Sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>AI Assistant</h1>
                <button id="view-toggle" class="icon-btn" title="Switch to Terminal View">
                    <i class="fas fa-terminal"></i>
                </button>
            </header>
            <div id="view-wrapper">
                <main id="chat-container">
                    <div id="message-list">
                         <div class="message assistant">
                            <div class="message-content">
                                <p>Hello! I'm your AI coding assistant. Paste your code or ask a question below. You can also use commands like <code>/suggest</code>, <code>/explain</code>, or type <code>/help</code> for more options.</p>
                            </div>
                        </div>
                    </div>
                    <div id="input-area">
                        <div id="input-wrapper">
                            <textarea id="prompt-input" placeholder="Enter code or ask a question..." rows="1"></textarea>
                            <button id="btn-send" title="Send Message"><i class="fas fa-paper-plane"></i></button>
                        </div>
                        <div id="action-buttons">
                            <button id="btn-suggest" data-action="suggest"><i class="fas fa-lightbulb"></i> Suggest Fix</button>
                            <button id="btn-explain" data-action="explain"><i class="fas fa-comment-dots"></i> Explain Code</button>
                        </div>
                    </div>
                </main>
                <main id="terminal-container" class="hidden">
                    <div id="terminal-output"></div>
                    <div id="terminal-input-area">
                        <label for="terminal-input" class="terminal-prompt">></label>
                        <input type="text" id="terminal-input" placeholder="Type a command... (e.g., /help)" autocomplete="off">
                    </div>
                </main>
            </div>
        </div>
    </div>
    
    <footer class="app-footer">
        <p>
            Developed by Siyabonga B Phakathi of The Voice & Eye of Bhambatha Inc. |
            <a href="https://www.bhambathatablog.wordpress.com" target="_blank" rel="noopener noreferrer">Blog</a> |
            <a href="https://www.facebook.com/C.Datoxic.P" target="_blank" rel="noopener noreferrer">Facebook</a> |
            <a href="https://www.websim.com/@whisperinggalaxyd" target="_blank" rel="noopener noreferrer">WebSim</a> |
            <a href="https://www.github.com/datoxic0" target="_blank" rel="noopener noreferrer">GitHub</a> |
            <a href="https://discord.com/channels/datoxic0" target="_blank" rel="noopener noreferrer">Discord</a> |
            <a href="https://x.com/Siya_B_Phakathi" target="_blank" rel="noopener noreferrer">X</a>
        </p>
    </footer>

    <script type="importmap">
    {
        "imports": {
            "marked": "https://cdn.jsdelivr.net/npm/marked@12.0.2/lib/marked.esm.js",
            "highlight.js": "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/es/highlight.min.js"
        }
    }
    </script>
    <script type="module" src="script.js"></script>
    <script>
        // Register the service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>
